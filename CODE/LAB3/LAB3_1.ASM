NAME 	LAB3_PROGRAM 
DATA 	SEGMENT
MESS 	DB 'INPUT 10 DECIMAL NUMBER',0DH,0AH,'$' 		;出错信息
ERROR 	DB 0DH,0AH,'NOT DECIMAL NUMBER',0DH,0AH,'$'
ERROR2	DB 0DH,0AH,'TOO MANY DIGITS!',0DH,0AH,'$'
MESS2	DB 0DH,0AH,'THE MAX NUMBER IS',0DH,0AH,'$'		;提示消息
MESS3	DB 0DH,0AH,'THE SORTED NUMBERS ARE',0DH,0AH,'$'
ORG 	1000H					;偏移量1000
NUMLIST DB 10 DUP(?)
DATA 	ENDS

STK	SEGMENT PARA STACK			;堆栈段
	DB 100 DUP(?)
STK	ENDS


CODE 	SEGMENT
	ASSUME CS:CODE,DS:DATA,ES:DATA,SS:STK
START:	MOV 	AX,DATA
	MOV 	DS,AX		;建立用户数据段
	MOV 	ES,AX
	MOV 	AX,STK
	MOV 	SS,AX	
	MOV 	AH,9
	MOV 	DX,OFFSET MESS ;显示提示消息
	INT 	21H
	MOV 	SI,0	
	MOV 	CH,0
INPUT:	INC CH ;输入，判断输入了第几个数 
	CMP	CH,03
	JLE	OK2	
	MOV	CH,0
		
OK2:	CMP	SI ,10
	JGE	OK
	CALL	INPUTDEC
	CMP	CH,02
	JE	SECOND
	JL	FIRST
	JG	THIRD
FIRST:	CMP	BX,0FFH	;第一个数
	JZ	RESET
	CMP	BX,0DH	
	JZ	RESET
	AND	BL,0FH
	MOV	DL,BL
	JMP	INPUT
SECOND:	CMP 	BX,0FFH ;第二个数
	JZ	RESET
	CMP	BX,0DH
	JZ	ONED
	AND 	BL,0FH
	SHL	DL,1
	SHL	DL,1
	SHL	DL,1
	SHL	DL,1
	OR	DL,BL
	
	JMP	INPUT
THIRD:	CMP	BX,0FFH ;第三个数
	JZ	RESET
	CMP	BX,0DH
	JNZ	SHOWERROR
	MOV	NUMLIST[SI],DL
	INC	SI
	JMP	RESET

ONED:	MOV 	NUMLIST[SI],DL ;对于一位数的处理
	INC	SI
	JMP	RESET
RESET:	MOV 	CH,0 ;重置
	JMP 	INPUT

SHOWERROR: ;显示错误信息
	CALL 	SHOWWARN2
	JMP	RESET

OK:	CALL 	SHOWALL
	CALL	SHOWMESS2
	CALL	SHOWMAX
	CALL	SHOWMESS3
	CALL 	SORT
	CALL 	SHOWALL
	MOV 	AH,4CH
	INT 	21H
	
INPUTDEC PROC  ;输入数的过程
	 MOV 	AH,01H
	 INT 	21H
	 CMP	AL,0DH
	 JZ	GOOD
	 CMP 	AL,'0'
	 JL	ERR1
	 CMP	AL,'9'
	 JG	ERR1
	 JLE	GOOD
ERR1:	 MOV 	BX,0FFH
	 CALL 	SHOWWARN
	 JMP	GOON
GOOD:	 MOV 	BL,AL
	 MOV 	BH,0H	  	
GOON:
	 RET
INPUTDEC ENDP

SHOWWARN PROC ;显示错误消息的过程
	 MOV DX,OFFSET ERROR
	 MOV AH,9
	 INT 21H
	 RET
SHOWWARN ENDP

SHOWWARN2 PROC ; 显示第二个错误消息
	 MOV	 DX,OFFSET ERROR2
	 MOV	AH,9
	 INT	21H
	 RET
SHOWWARN2 ENDP

SHOWMESS2 PROC
	MOV	DX,OFFSET MESS2
	MOV	AH,9
	INT	21H
	RET
SHOWMESS2 ENDP

SHOWMESS3 PROC
	MOV	DX,OFFSET MESS3
	MOV	AH,9
	INT	21H
	RET
SHOWMESS3 ENDP


SHOWALL PROC ;显示所有数的过程
	MOV 	SI,0
LP:	MOV	BL,NUMLIST[SI]
	MOV	BH,BL
	MOV 	CL,4
	AND	BL,0FH
	OR	BL,30H
	SHR	BH,CL
	AND	BH,0FH
	OR	BH,30H 
	MOV	AH,02H 
	MOV	DL,0DH 
	INT	21H
	MOV	DL,0AH
	INT 	21H
	MOV 	DL,BH
	INT	21H
	MOV	DL,BL
	INT	21H
	INC 	SI
	CMP	SI,10
	JL	LP
	RET
SHOWALL	ENDP


SHOWMAX PROC ;显示最大数的过程
	MOV 	SI,0
	MOV 	DL,0
LOOP2:	MOV 	DH,NUMLIST[SI]
	INC 	SI
	CMP	SI,10
	JG	OK3
	CMP	DH,DL	
	JBE	LOOP2	
	MOV	DL,DH
	JMP	LOOP2	
OK3:	
	MOV 	BL,DL
	MOV 	BH,DL
	MOV 	CL,4
	AND	BL,0FH
	OR	BL,30H
	SHR	BH,CL
	AND	BH,0FH
	OR	BH,30H 
	MOV	AH,02H 

	MOV	DL,BH
	INT	21H
	MOV	DL,BL
	INT	21H
	
	RET
SHOWMAX ENDP

SORT	PROC ;排序过程
	MOV 	SI,0
	
LOOPOUT:
	MOV 	DI,0
LOOPIN:	
	MOV	AL,NUMLIST[SI]
	MOV	BL,NUMLIST[DI]
	CMP	AL,BL
	JBE	SKIP
	MOV	NUMLIST[SI],BL
	MOV	NUMLIST[DI],AL


SKIP:
	
	INC DI
	CMP DI,SI
	JL LOOPIN
	INC SI
	CMP SI,10
	JL LOOPOUT

	RET
SORT	ENDP
	
CODE 	ENDS
END 	START

